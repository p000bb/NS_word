# 合并文档

将多个 Word 文档按顺序合并成一个完整的文档。

## 功能概述

合并文档功能可以将多个 Word 文档根据模板文档的样式按照指定顺序合并成一个完整的文档。合并完成后，系统会自动生成目录、表目录、图目录，支持中英文两种语言模式。

::: info 技术实现
合并子文档功能通过调用 [DocxMerge](https://github.com/jamessantiago/DocxMerge) 程序执行。DocxMerge 是一个简单的命令行工具，用于按顺序合并多个 Word 文档。
:::

## 使用步骤

### 1. 选择模板文件

点击"选择文件"按钮，选择用于合并的模板 Word 文档（可选）。

模板文件将作为合并后文档的基础格式。

![选择模板文件](https://raw.githubusercontent.com/p000bb/Image/master/NS_word/2026-01-16-14-55-22.png)

### 2. 选择保存路径

点击"选择文件夹"按钮，选择合并后文档的保存位置。

::: tip 快速访问
选择保存路径后，可以直接点击显示的文件夹地址，系统会自动打开本地文件夹，方便您查看保存位置。
:::

![选择保存路径](https://raw.githubusercontent.com/p000bb/Image/master/NS_word/2026-01-16-14-55-37.png)

### 3. 选择目录语言

选择目录、表目录、图目录的显示语言：

- **中文**：目录、表目录、图目录
- **English**：Contents、List of Tables、List of Figures

![选择目录语言](https://raw.githubusercontent.com/p000bb/Image/master/NS_word/2026-01-16-14-55-55.png)

### 4. 上传文档

**方式一**：点击上传区域，选择多个 `.docx` 文件

**方式二**：直接拖拽文件到上传区域

支持多次上传，同名文件会自动覆盖。

![上传文档](https://raw.githubusercontent.com/p000bb/Image/master/NS_word/2026-01-16-14-56-21.png)

### 5. 调整文档顺序（可选）

在文档列表中，拖拽文件卡片可以调整合并顺序：

- 蓝色指示线显示插入位置
- 点击"恢复默认顺序"可恢复为上传时的顺序
- 点击"清空所有文档"可移除所有文档

![调整文档顺序](https://raw.githubusercontent.com/p000bb/Image/master/NS_word/2026-01-16-14-56-54.png)

### 6. 开始合并

确认文档列表和配置无误后，点击"开始合并"按钮。

系统会显示每个文档的处理状态，合并完成后会显示成功和失败的数量。

![开始合并](https://raw.githubusercontent.com/p000bb/Image/master/NS_word/2026-01-16-14-58-12.png)

### 7. 更新域代码

::: warning 重要提示
合并完成后，需要在 Microsoft Word 中打开文档，按 `F9` 键更新域代码，目录才会显示完整内容。
:::

### 8. 优化文档体积

::: info 文档体积说明
合并后的文档体积会比较大，因为使用的是链接的方式合并所有文档，所以合并后的体积是所有文档体积之和。建议使用 Microsoft Word重新保存一下文档，Office 会自动修复处理并优化文档体积。
:::

## 功能特点

- ✅ **拖拽排序**：支持通过拖拽调整文档合并顺序，操作直观便捷
- ✅ **实时状态**：显示每个文档的处理状态（待处理/处理中/已完成/失败）
- ✅ **进度提示**：显示系统处理进度和阶段信息，实时反馈处理情况
- ✅ **错误提示**：如果某个文档处理失败，会显示具体错误信息，便于排查问题
- ✅ **自动生成目录**：合并完成后自动生成目录、表目录、图目录，支持中英文两种模式
- ✅ **多语言支持**：支持中文和英文两种目录语言模式，满足不同文档需求

## 目录生成逻辑

### 1. 目录生成

系统会根据选择的语言自动生成以下目录：

**中文模式**：
- 📑 目录
- 📊 表目录
- 🖼️ 图目录

**英文模式**：
- 📑 Contents
- 📊 List of Tables
- 🖼️ List of Figures

### 2. 目录样式设置

- 所有目录标题使用模板文档的**标题 1 样式**
- 目录标题设置为**居中对齐**
- 目录标题不参与自动编号

### 3. 题注提取规则

系统会根据选择的语言提取文档中的题注：

**中文模式**：
- **表目录**：提取所有以"表"开头的题注（如"表 1-1"、"表 2-3"等）
- **图目录**：提取所有以"图"开头的题注（如"图 1-1"、"图 2-3"等）

**英文模式**：
- **表目录**：提取所有以"Table"开头的题注（如"Table 1-1"、"Table 2-3"等）
- **图目录**：提取所有以"Figure"开头的题注（如"Figure 1-1"、"Figure 2-3"等）

### 4. 域代码说明

系统使用 Word 域代码自动生成目录，各目录使用的域代码如下：

**目录**：
```
TOC \o "1-6" \h \z \u
```

- `\o "1-6"`：提取标题 1 到标题 6 的内容
- `\h`：将目录项设置为超链接
- `\z`：在 Web 视图中隐藏制表符和前导符
- `\u`：使用应用的样式级别而不是 TC 条目

**表目录**（中文）：
```
TOC \h \z \c "表"
```

**表目录**（英文）：
```
TOC \h \z \c "Table"
```

**图目录**（中文）：
```
TOC \h \z \c "图"
```

**图目录**（英文）：
```
TOC \h \z \c "Figure"
```

### 5. 目录位置和格式

- 三个目录按顺序插入在合并文档的最前面
- 每个目录前都有分页符，确保目录独立成页
- 目录之间有空行分隔
- 目录生成后，需要在 Microsoft Word 中按 `F9` 更新域代码才能显示完整内容

## 注意事项

- 合并顺序按照文档列表中的顺序进行
- 如果某个文档处理失败，其他文档仍会继续处理
- 合并后的文件名格式：`第一个文档名_合并.docx`
- 确保文档中的题注使用正确的标签格式（中文使用"表"和"图"，英文使用"Table"和"Figure"），否则无法正确提取到表目录和图目录中

## 相关链接

- [模板生成](./template-generation.md) - 生成合并时使用的模板
- [拆分文档](./document-split.md) - 将文档拆分成多个小文档
- [DocxMerge](https://github.com/jamessantiago/DocxMerge) - 合并文档功能使用的底层工具
